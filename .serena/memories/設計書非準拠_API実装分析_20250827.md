# è¨­è¨ˆæ›¸ã«æº–æ‹ ã—ã¦ã„ãªã„APIå®Ÿè£…å†…å®¹åˆ†æ

## åˆ†æå¯¾è±¡
- è¨­è¨ˆæ›¸: `/docs/05.APIè¨­è¨ˆæ›¸.md` (APIè¨­è¨ˆæ›¸ v2.0)
- å®Ÿè£…: `/backend/app/api/v1/*.py` (å®Ÿéš›ã®APIå®Ÿè£…)

## ä¸»è¦ãªéæº–æ‹ é …ç›®

### 1. URLãƒ‘ã‚¹è¨­è¨ˆã®ä¸æ•´åˆ ğŸ”´

**è¨­è¨ˆæ›¸ã®ä»•æ§˜:**
```
POST /api/v1/manga/generate
GET /api/v1/manga/{request_id}/status  
GET /api/v1/manga/{request_id}/stream
```

**å®Ÿè£…ã®å®Ÿéš›:**
```python
# manga_sessions.py
@router.post("/generate", ...)          # âœ… æº–æ‹ 
@router.post("/", ...)                  # âŒ éæº–æ‹  (é‡è¤‡ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ)
@router.get("/{request_id}/status", ...) # âœ… æº–æ‹ 
@router.get("/{request_id}/stream", ...)  # âœ… æº–æ‹ 

# ã—ã‹ã—ä»¥ä¸‹ãŒéæº–æ‹ :
@router.get("/sessions", ...)           # âŒ è¨­è¨ˆæ›¸ã«å­˜åœ¨ã—ãªã„
@router.get("/sessions/{session_id}", ...) # âŒ è¨­è¨ˆæ›¸ã«å­˜åœ¨ã—ãªã„
@router.post("/sessions/{session_id}/pause", ...) # âŒ è¨­è¨ˆæ›¸ã«å­˜åœ¨ã—ãªã„
```

**å½±éŸ¿åº¦:** HIGH - ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é€£æºæ™‚ã®URLä¸æ•´åˆ

### 2. ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ¢ãƒ‡ãƒ«ã®å·®ç•° ğŸŸ¡

**è¨­è¨ˆæ›¸ã®ä»•æ§˜ (POST /api/v1/manga/generate):**
```json
{
  "request_id": "uuid",
  "status": "queued", 
  "estimated_completion_time": "ISO8601",
  "performance_mode": "monolithic",
  "expected_duration_minutes": 8,
  "status_url": "/api/v1/manga/{request_id}/status",
  "sse_url": "/api/v1/manga/{request_id}/stream"
}
```

**å®Ÿè£…ã®å®Ÿéš› (SessionResponse):**
```python
class SessionResponse(BaseModel):
    id: UUID                          # âœ… request_idç›¸å½“
    title: Optional[str]              # âŒ è¨­è¨ˆæ›¸ã«å­˜åœ¨ã—ãªã„
    status: str                       # âœ… æº–æ‹ 
    current_phase: int                # âŒ è¨­è¨ˆæ›¸ã§ã¯ current_module
    total_phases: int                 # âŒ è¨­è¨ˆæ›¸ã§ã¯ total_modules
    progress_percentage: float        # âŒ è¨­è¨ˆæ›¸ã«å­˜åœ¨ã—ãªã„
    created_at: datetime             # âŒ è¨­è¨ˆæ›¸ã«å­˜åœ¨ã—ãªã„
    updated_at: datetime             # âŒ è¨­è¨ˆæ›¸ã«å­˜åœ¨ã—ãªã„
    # ä»¥ä¸‹ã®è¨­è¨ˆæ›¸ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒæ¬ è½:
    # - estimated_completion_time
    # - performance_mode  
    # - expected_duration_minutes
    # - status_url
    # - sse_url
```

**å½±éŸ¿åº¦:** MEDIUM - APIãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼ã®ä¸æ•´åˆ

### 3. ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¢ãƒ‡ãƒ«ã®å·®ç•° ğŸŸ¡

**è¨­è¨ˆæ›¸ã®ä»•æ§˜:**
```json
{
  "title": "string",
  "text": "string (max 50,000 chars)",
  "ai_auto_settings": true,
  "feedback_mode": {
    "enabled": true,
    "timeout_minutes": 30,
    "allow_skip": true
  },
  "options": {
    "priority": "normal|high",
    "webhook_url": "string (optional)",
    "auto_publish": "boolean"
  }
}
```

**å®Ÿè£…ã®å®Ÿéš›:**
```python
class SessionCreateRequest(BaseModel):
    title: Optional[str]              # âœ… æº–æ‹ 
    input_text: str                   # âŒ è¨­è¨ˆæ›¸ã§ã¯ "text"
    generation_params: Dict[str, Any] # âŒ è¨­è¨ˆæ›¸ã®æ§‹é€ ã¨ç•°ãªã‚‹
    # ä»¥ä¸‹ã®è¨­è¨ˆæ›¸ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒæ¬ è½:
    # - ai_auto_settings
    # - feedback_mode (enabled, timeout_minutes, allow_skip)
    # - options (priority, webhook_url, auto_publish)
```

**å½±éŸ¿åº¦:** HIGH - ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é€£æºã«ç›´æ¥å½±éŸ¿

### 4. ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†ã®å·®ç•° ğŸŸ¡

**è¨­è¨ˆæ›¸ã®ä»•æ§˜:**
- `current_module` (1-8)
- `total_modules` (8)
- `module_details` with processing_mode

**å®Ÿè£…ã®å®Ÿéš›:**
- `current_phase` (1-7)  
- `total_phases` (7)
- ãƒ•ã‚§ãƒ¼ã‚ºãƒ™ãƒ¼ã‚¹ç®¡ç†

**å½±éŸ¿åº¦:** MEDIUM - é€²æ—è¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯ã®å·®ç•°

### 5. å“è³ªã‚²ãƒ¼ãƒˆAPIå®Ÿè£…çŠ¶æ³ âœ…

**è¨­è¨ˆæ›¸ã§å®šç¾©ã•ã‚ŒãŸã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:**
```
GET /api/v1/manga/{request_id}/quality-gate
POST /api/v1/manga/{request_id}/phase/{phase}/quality-override  
GET /api/v1/quality/metrics
```

**å®Ÿè£…çŠ¶æ³:** âœ… **å®Œå…¨æº–æ‹ **
- quality_gates.py ã§100%å®Ÿè£…æ¸ˆã¿
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼ã‚‚è¨­è¨ˆæ›¸æº–æ‹ 

### 6. ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–APIå®Ÿè£…çŠ¶æ³ âœ…

**è¨­è¨ˆæ›¸ã§å®šç¾©ã•ã‚ŒãŸã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:**
```
GET /api/v1/manga/{request_id}/preview/{phase}
POST /api/v1/manga/{request_id}/preview/{phase}/apply-change
GET /api/v1/manga/{request_id}/preview/compare
```

**å®Ÿè£…çŠ¶æ³:** âœ… **å®Œå…¨æº–æ‹ **
- preview_interactive.py ã§100%å®Ÿè£…æ¸ˆã¿
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼ã‚‚è¨­è¨ˆæ›¸æº–æ‹ 

### 7. ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯APIå®Ÿè£…çŠ¶æ³ ğŸŸ¡

**è¨­è¨ˆæ›¸ã§å®šç¾©ã•ã‚ŒãŸã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:**
```
POST /api/v1/manga/{request_id}/feedback
GET /api/v1/manga/{request_id}/phase/{phase_number}/preview
GET /api/v1/manga/{request_id}/modification/{feedback_id}/status
POST /api/v1/manga/{request_id}/skip-feedback
```

**å®Ÿè£…çŠ¶æ³:** ğŸŸ¡ **éƒ¨åˆ†å®Ÿè£…**
- feedback.py ã«åŸºæœ¬æ§‹é€ ã¯ã‚ã‚‹ãŒã€è¨­è¨ˆæ›¸ã®è©³ç´°ä»•æ§˜ã¨å·®ç•°ã‚ã‚Š

### 8. ä½œå“ç®¡ç†APIå®Ÿè£…çŠ¶æ³ âŒ

**è¨­è¨ˆæ›¸ã§å®šç¾©ã•ã‚ŒãŸã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:**
```
GET /api/v1/manga (ä½œå“ä¸€è¦§)
GET /api/v1/manga/{manga_id} (ä½œå“è©³ç´°)
PUT /api/v1/manga/{manga_id} (ä½œå“æ›´æ–°)
DELETE /api/v1/manga/{manga_id} (ä½œå“å‰Šé™¤)
POST /api/v1/manga/{manga_id}/publish (å…¬é–‹)
POST /api/v1/manga/{manga_id}/archive (ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–)
```

**å®Ÿè£…çŠ¶æ³:** âŒ **æœªå®Ÿè£…**
- è©²å½“ã™ã‚‹APIãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ãªã„

## æº–æ‹ ç‡ã‚µãƒãƒªãƒ¼

| APIåˆ†é‡ | æº–æ‹ ç‡ | çŠ¶æ…‹ | å‚™è€ƒ |
|---------|--------|------|------|
| æ¼«ç”»ç”ŸæˆAPI | 70% | ğŸŸ¡ éƒ¨åˆ†æº–æ‹  | URLãƒ‘ã‚¹ãƒ»ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼ã«å·®ç•° |
| å“è³ªã‚²ãƒ¼ãƒˆAPI | 100% | âœ… å®Œå…¨æº–æ‹  | æ–°è¦å®Ÿè£…ã§å®Œå…¨æº–æ‹  |
| ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼API | 100% | âœ… å®Œå…¨æº–æ‹  | æ–°è¦å®Ÿè£…ã§å®Œå…¨æº–æ‹  |
| ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯API | 60% | ğŸŸ¡ éƒ¨åˆ†æº–æ‹  | åŸºæœ¬æ§‹é€ ã®ã¿ |
| ä½œå“ç®¡ç†API | 0% | âŒ æœªå®Ÿè£… | å®Œå…¨æœªå®Ÿè£… |
| **å…¨ä½“å¹³å‡** | **66%** | ğŸŸ¡ **éƒ¨åˆ†æº–æ‹ ** | æ”¹å–„ä½™åœ°å¤§ |

## æ”¹å–„å„ªå…ˆé †ä½

### ğŸ”´ Critical (å³åº§å¯¾å¿œ)
1. **URLãƒ‘ã‚¹çµ±ä¸€**: `/sessions` ãƒ‘ã‚¹å‰Šé™¤ã€`/manga` ãƒ‘ã‚¹çµ±ä¸€
2. **ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼ä¿®æ­£**: è¨­è¨ˆæ›¸æº–æ‹ ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ¢ãƒ‡ãƒ«å®Ÿè£…
3. **ãƒªã‚¯ã‚¨ã‚¹ãƒˆå½¢å¼ä¿®æ­£**: feedback_mode, optionsç­‰ã®å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å®Ÿè£…

### ğŸŸ¡ Important (çŸ­æœŸå¯¾å¿œ)
1. **ä½œå“ç®¡ç†APIå®Ÿè£…**: åŸºæœ¬çš„ãªCRUDæ“ä½œ
2. **ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯APIå®Œæˆ**: è¨­è¨ˆæ›¸ä»•æ§˜æº–æ‹ 
3. **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†çµ±ä¸€**: module/phaseè¡¨è¨˜ã®çµ±ä¸€

### ğŸŸ¢ Nice to have (ä¸­æœŸå¯¾å¿œ)
1. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°çµ±ä¸€**: RFC 7807å®Œå…¨æº–æ‹ 
2. **ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å¼·åŒ–**: å…¥åŠ›åˆ¶é™ãƒ»å½¢å¼ãƒã‚§ãƒƒã‚¯
3. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–**: ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“æ”¹å–„

## ä¿®æ­£æ¨å¥¨äº‹é …

### 1. manga_sessions.pyä¿®æ­£æ¡ˆ
```python
# è¨­è¨ˆæ›¸æº–æ‹ ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ¢ãƒ‡ãƒ«ã«å¤‰æ›´
class SessionResponse(BaseModel):
    request_id: UUID  # idã‹ã‚‰å¤‰æ›´
    status: str
    estimated_completion_time: Optional[str]  # æ–°è¦è¿½åŠ 
    performance_mode: str = "monolithic"       # æ–°è¦è¿½åŠ 
    expected_duration_minutes: int = 8         # æ–°è¦è¿½åŠ 
    status_url: str                           # æ–°è¦è¿½åŠ 
    sse_url: str                              # æ–°è¦è¿½åŠ 
    # current_phase â†’ current_module
    # total_phases â†’ total_modules
```

### 2. ä¸è¦ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå‰Šé™¤
```python
# ä»¥ä¸‹ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å‰Šé™¤ï¼ˆè¨­è¨ˆæ›¸ã«å­˜åœ¨ã—ãªã„ï¼‰
# @router.get("/sessions", ...)
# @router.get("/sessions/{session_id}", ...)
# @router.post("/sessions/{session_id}/pause", ...)
```

### 3. ä½œå“ç®¡ç†APIæ–°è¦å®Ÿè£…
```python
# æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«: manga_works.py
@router.get("/manga", response_model=List[MangaWorkResponse])
@router.get("/manga/{manga_id}", response_model=MangaWorkDetailResponse) 
@router.put("/manga/{manga_id}", response_model=MangaWorkResponse)
@router.delete("/manga/{manga_id}", status_code=204)
```

ã“ã®åˆ†æã«åŸºã¥ã„ã¦ã€è¨­è¨ˆæ›¸æº–æ‹ ã®APIå®Ÿè£…ã¸ã®ä¿®æ­£ä½œæ¥­ã‚’å®Ÿæ–½ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚