# HITL修正計画

## 概要
各フェーズにHuman-in-the-Loop機能を追加し、プレビューとチャットベースのフィードバックを実装する。

## 各フェーズのHITL仕様

### Phase 1: コンセプト・世界観分析（12秒）
- **プレビュー内容**: テーマ、ジャンル、世界観、対象読者層
- **チャット修正オプション**: テーマ修正、ジャンル変更、世界観調整、雰囲気変更
- **インタラクティブ要素**: ジャンルセレクタ、雰囲気スライダー

### Phase 2: キャラクター設定（18秒）
- **プレビュー内容**: キャラクタービジュアル、性格設定、関係性図
- **チャット修正オプション**: キャラ追加/削除、性格変更、ビジュアル調整、関係性修正
- **インタラクティブ要素**: キャラクターエディタ、関係性マップ

### Phase 3: プロット・ストーリー構成（15秒）
- **プレビュー内容**: 3幕構成図、起承転結、感情曲線グラフ
- **チャット修正オプション**: プロット変更、ペーシング調整、クライマックス修正
- **インタラクティブ要素**: タイムラインエディタ、感情曲線調整

### Phase 4: ネーム生成（20秒）
- **プレビュー内容**: コマ割りレイアウト、構図プレビュー、演出指示
- **チャット修正オプション**: コマ割り変更、構図調整、演出修正、セリフ位置変更
- **インタラクティブ要素**: コマ割りグリッド、構図セレクタ

### Phase 5: シーン画像生成（25秒）
- **プレビュー内容**: 生成画像ギャラリー、スタイル確認パネル
- **チャット修正オプション**: 画像再生成、スタイル変更、品質向上、色調整
- **インタラクティブ要素**: スタイルセレクタ、色調整スライダー

### Phase 6: セリフ配置（4秒）
- **プレビュー内容**: セリフバブル配置、フォント表示、効果音配置
- **チャット修正オプション**: セリフ位置調整、フォント変更、効果音追加/削除
- **インタラクティブ要素**: ドラッグ&ドロップ配置、フォントセレクタ

### Phase 7: 最終統合・品質調整（3秒）
- **プレビュー内容**: 最終ページプレビュー、全体構成確認
- **チャット修正オプション**: 最終調整、フォーマット選択、品質設定
- **インタラクティブ要素**: ページビューア、出力設定パネル

## 技術実装要件

### WebSocket通信
- フェーズ進捗リアルタイム通知
- フィードバック待機状態通知
- プレビュー更新イベント
- チャットメッセージ配信

### チャットインターフェース
- 自然言語処理（Gemini Pro使用）
- クイックアクションボタン
- 修正履歴表示
- タイムアウト管理（30分）

### プレビューシステム
- フェーズ別専用プレビューコンポーネント
- インタラクティブ編集機能
- バージョン管理（無制限履歴）
- 品質レベル自動調整（5段階）

## データベース追加要件
- phase_feedbacks テーブル
- phase_previews テーブル
- chat_messages テーブル
- preview_versions テーブル