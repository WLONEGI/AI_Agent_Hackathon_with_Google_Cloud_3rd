# Spell - AIストーリー生成サービス 要件定義書

**文書管理情報**
- 文書ID: REQ-DOC-001
- 作成日: 2025-08-28
- 版数: 5.0
- 承認者: [承認者名]

## 目次

- [1. エグゼクティブサマリー](#1-エグゼクティブサマリー)
  - [プロジェクト概要](#プロジェクト概要)
  - [ビジネス価値と期待効果](#ビジネス価値と期待効果)
  - [主要なステークホルダー](#主要なステークホルダー)
  - [スコープと制約事項](#スコープと制約事項)
- [2. 機能要件](#2-機能要件)
  - [2.1 ユーザーストーリー](#21-ユーザーストーリー)
  - [2.2 機能一覧](#22-機能一覧)
    - [2.2.1 入力機能](#221-入力機能)
    - [2.2.2 処理機能](#222-処理機能)
    - [2.2.3 出力機能](#223-出力機能)
  - [2.3 ユースケース図](#23-ユースケース図)
- [3. 非機能要件](#3-非機能要件)
  - [3.1 性能要件](#31-性能要件)
  - [3.2 セキュリティ要件](#32-セキュリティ要件)
  - [3.3 可用性要件](#33-可用性要件)
- [4. 実装要件詳細](#4-実装要件詳細)
  - [4.1 機能要件マップ](#41-機能要件マップ)
  - [4.2 技術スタック要件](#42-技術スタック要件)
  - [4.3 実装依存関係](#43-実装依存関係)
  - [4.4 品質・パフォーマンス制約](#44-品質パフォーマンス制約)
  - [4.5 実装優先度マトリクス](#45-実装優先度マトリクス)
- [5. システムアーキテクチャ](#5-システムアーキテクチャ)
  - [5.1 システム構成図](#51-システム構成図)
  - [5.2 データフロー図](#52-データフロー図)
  - [5.3 技術スタック](#53-技術スタック)
- [6. 制約事項とリスク](#6-制約事項とリスク)
  - [6.1 技術的制約](#61-技術的制約)
  - [6.2 ビジネス制約](#62-ビジネス制約)
  - [6.3 リスク評価マトリクス](#63-リスク評価マトリクス)
- [7. 用語集と略語一覧](#7-用語集と略語一覧)
  - [用語集](#用語集)
  - [略語一覧](#略語一覧)
- [改訂履歴](#改訂履歴)

---

## 1. エグゼクティブサマリー

### プロジェクト概要
小説や自己啓発本から完全自動で長編漫画を生成するAIサービス「Spell」。テキスト入力のみで高品質な漫画コンテンツを制作可能。

### ビジネス価値と期待効果
- **市場機会**: 創作スキルのない層への漫画制作サービス提供
- **収益予測**: サブスクリプション及び従量課金モデル
- **差別化要因**: 業界初の完全自動化による圧倒的利便性

### 主要なステークホルダー
- **プライマリユーザー**: アマチュア作家、コンテンツクリエイター
- **技術パートナー**: Google Cloud Platform
- **競合**: Midjourney、ComicAI（半自動ツール）

### スコープと制約事項
- **対象**: 日本語テキストからの漫画生成（初期フェーズ）
- **制約**: Google統合スタック必須、著作権フィルタリング必要
- **除外**: リアルタイム生成、動画形式出力（将来フェーズ）

---

## 2. 機能要件

### 2.1 ユーザーストーリー

| ID | ユーザー種別 | 機能 | 価値 |
|---|---|---|---|
| US-001 | アマチュア作家 | Spellでテキストから漫画を自動生成 | 絵画スキル不要で作品化 |
| US-002 | コンテンツクリエイター | SNS投稿用漫画作成 | 効率的なコンテンツ制作 |
| US-003 | 全ユーザー | 作品管理・編集 | 継続的な創作活動支援 |
| US-004 | 全ユーザー | 各段階での自然言語による修正指示 | 理想的な作品への調整 |
| US-005 | 全ユーザー | 段階的なプレビューと確認 | 期待通りの結果への誘導 |

### 2.2 機能一覧

#### 2.2.1 入力機能

**要件ID**: REQ-FNC-001  
**要件名**: テキスト入力システム  
**説明**: ユーザーはプレーンテキストまたは構造化テキストを入力可能  
**優先度**: Must  
**受入条件**: 
- 最大50,000文字の入力対応
- UTF-8エンコーディング対応
- 構造化マークアップ（章、節）の自動認識

**要件ID**: REQ-FNC-002  
**要件名**: AI自動設定システム  
**説明**: AIがテキスト内容を分析して適切なスタイル、ページ数、キャラクター数を自動決定  
**優先度**: Must  
**受入条件**: 
- テキスト解析による適切なスタイル自動選択
- 内容量に応じた適切なページ数自動決定
- ストーリー分析による必要キャラクター数自動設定

#### 2.2.2 処理機能

**要件ID**: REQ-FNC-003  
**要件名**: 7フェーズHITL処理システム  
**説明**: Human-in-the-loop機能を組み込んだ7フェーズによる漫画生成  
**優先度**: Must  
**受入条件**: 
- 各フェーズでの中間結果表示と自然言語フィードバック機能
- Phase 1: コンセプト・世界観分析Agent（12秒以内） - 入力テキストから物語のコンセプト・テーマ・ジャンル・ターゲット読者層・世界観を決定
  - プレビュー: テーマ、ジャンル、世界観、対象読者層の可視化
  - チャット修正: テーマ修正、ジャンル変更、世界観調整、雰囲気変更
- Phase 2: キャラクター設定・簡易ビジュアル生成Agent（18秒以内） - Phase1結果を基にキャラクター詳細設定・簡易ビジュアル生成（1-2枚の参考画像）
  - プレビュー: キャラクタービジュアル、性格設定、関係性図
  - チャット修正: キャラ追加/削除、性格変更、ビジュアル調整、関係性修正
- Phase 3: プロット・ストーリー構成Agent（15秒以内） - 詳細なプロット・ストーリー構成作成（3幕構成）
  - プレビュー: 3幕構成図、起承転結、感情曲線グラフ
  - チャット修正: プロット変更、ペーシング調整、クライマックス修正
- Phase 4: ネーム生成Agent（20秒以内） - コマ割り設計・シーン詳細指示・カメラアングル・演出指示（Phase1の世界観情報を活用）
  - プレビュー: コマ割りレイアウト、構図プレビュー、演出指示
  - チャット修正: コマ割り変更、構図調整、演出修正、セリフ位置変更
- Phase 5: シーン画像生成Agent（25秒以内） - コマごとのシーン画像を並列生成（Imagen 4使用）
  - プレビュー: 生成画像ギャラリー、スタイル確認パネル
  - チャット修正: 画像再生成、スタイル変更、品質向上、色調整
- Phase 6: セリフ配置Agent（4秒以内） - 吹き出し・セリフ・効果音の配置最適化
  - プレビュー: セリフバブル配置、フォント表示、効果音配置
  - チャット修正: セリフ位置調整、フォント変更、効果音追加/削除
- Phase 7: 最終統合・品質調整Agent（3秒以内） - 最終品質チェック・統合処理・出力
  - プレビュー: 最終ページプレビュー、全体構成確認
  - チャット修正: 最終調整、フォーマット選択、品質設定
- 全フェーズ合計97秒以内処理完了（キャッシュ活用で70秒まで短縮可能）
- 各フェーズ最大30分のフィードバック待機時間
- Phase1の世界観情報は全フェーズで参照可能な設計

**要件ID**: REQ-FNC-004  
**要件名**: 品質ゲート管理  
**説明**: 各Agentで品質判定を実行し、基準未達時は再生成  
**優先度**: Must  
**受入条件**: 
- 各Agent 70%以上の品質スコア（MVP基準）
- 最大3回の再試行
- 詳細な品質レポート生成

#### 2.2.3 出力機能

**要件ID**: REQ-FNC-005  
**要件名**: 漫画出力システム  
**説明**: 複数フォーマットでの漫画出力機能  
**優先度**: Must  
**受入条件**: 
- PDF形式（印刷用）出力
- WebP形式（Web用）出力
- 300dpi解像度保証

**要件ID**: REQ-FNC-006  
**要件名**: インタラクティブビューアー  
**説明**: ブラウザ上での漫画閲覧機能  
**優先度**: Should  
**受入条件**: 
- ページめくり機能
- ズーム・パン操作
- モバイル対応

**要件ID**: REQ-FNC-007  
**要件名**: HITLプレビューシステム  
**説明**: 各フェーズの成果物をリアルタイムでプレビュー表示  
**優先度**: Must  
**受入条件**: 
- フェーズ別専用プレビューコンポーネント
- インタラクティブ編集機能（ドラッグ&ドロップ、テキスト編集）
- バージョン管理（無制限履歴、60日保持）
- 品質レベル自動調整（デバイス性能に応じた5段階）
- WebSocket経由のリアルタイム更新

**要件ID**: REQ-FNC-008  
**要件名**: チャットベースフィードバックシステム  
**説明**: 自然言語でのフィードバック入力と修正指示  
**優先度**: Must  
**受入条件**: 
- 自然言語処理によるフィードバック解析（Gemini Pro使用）
- クイックアクションボタン（よく使う修正オプション）
- フィードバック履歴管理
- タイムアウト機能（30分後自動スキップ）
- リアルタイムチャット通信（WebSocket使用）

**要件ID**: REQ-FNC-007  
**要件名**: 画像生成並列処理システム  
**説明**: Phase 6での画像生成処理の並列化による高速化  
**優先度**: Should  
**受入条件**: 
- 3-5枚の画像を同時生成可能
- 画像生成時間を60-70%短縮（6秒→2秒以内）
- シーン類似度に基づく最適化キャッシング
- 生成進捗のリアルタイム表示
- エラー発生時の部分回復機能
- 並列度の動的調整（システム負荷に応じて）

**要件ID**: REQ-FNC-008  
**要件名**: リアルタイムフィードバックシステム（HITL）  
**説明**: 各フェーズ完了時にユーザーが自然言語により修正指示を行える機能  
**優先度**: Must  
**受入条件**: 
- 各フェーズ完了時の結果プレビュー表示（Claude Artifact風UI）
- 自然言語入力による修正指示（例：「キャラクター名をもっと印象的に」）
- 30秒のフィードバックタイムアウト機能
- AI応答によるフィードバック反映の確認
- フィードバックスキップ機能

**要件ID**: REQ-FNC-008  
**要件名**: 修正履歴管理  
**説明**: ユーザーの修正指示と結果を記録・管理する機能  
**優先度**: Should  
**受入条件**: 
- 修正前後の状態保存
- undo/redo機能
- 修正履歴の可視化

### 2.3 ユースケース図

```mermaid
graph TD
    A[ユーザー] -->|テキスト入力| B[Claude風ホーム画面]
    B -->|生成開始| C[7フェーズHITL処理]
    C -->|フェーズ完了| D[Artifact風プレビュー]
    D -->|フィードバック入力| E[自然言語解析]
    D -->|スキップ/タイムアウト| F[次フェーズ]
    E -->|修正適用| C
    F -->|全フェーズ完了| G[完成モーダル]
    G -->|PDFダウンロード| H[PDF出力]
    G -->|新規作成| B
    A -->|リアルタイムログ監視| I[処理ログ]
    A -->|進捗確認| J[7/7完了表示]
```

---

## 3. 非機能要件

### 3.1 性能要件

**要件ID**: REQ-NFR-001  
**要件名**: 処理時間制限（HITLモード）  
**説明**: 各フェーズは高速処理、全体は3-5分で完了（フィードバック時間除く）  
**根拠**: 実装済みモックでの検証結果  
**受入条件**: 
- フェーズ1: テキスト解析（3秒）
- フェーズ2-7: 各3-6秒での高速処理
- 全フェーズ合計: 97秒以内（標準版）/ 70秒以内（キャッシュ活用版）（フィードバック待機時間除く）
- リアルタイムログ表示とタイムスタンプ

**要件ID**: REQ-NFR-002  
**要件名**: 同時処理能力（HITL対応）  
**説明**: 10ユーザーの同時処理をサポート（HITLセッション管理含む）  
**根拠**: ハッカソンデモでの現実的な同時処理数  
**受入条件**: 
- 10並行HITLセッションでの安定動作
- セッション状態管理（各フェーズ30秒のフィードバックタイムアウト）
- EventTarget設計による疎結合アーキテクチャ
- 基本的なオートスケーリング（最大10インスタンス）

### 3.2 セキュリティ要件

**要件ID**: REQ-NFR-003  
**要件名**: データ保護  
**説明**: ユーザーデータの暗号化と安全な保存  
**根拠**: 個人情報保護法準拠  
**受入条件**: 
- 保存時暗号化（AES-256）
- 転送時暗号化（TLS 1.3）
- アクセスログ記録

**要件ID**: REQ-NFR-004  
**要件名**: コンテンツフィルタリング  
**説明**: 不適切コンテンツの基本的な検出・除外  
**根拠**: ハッカソンデモでの安全性確保  
**受入条件**: 
- 暴力・性的表現の基本検出（60%以上）
- 明らかに不適切なコンテンツの除外
- 簡単な管理者確認

### 3.3 可用性要件

**要件ID**: REQ-NFR-005  
**要件名**: システム稼働率  
**説明**: 90%以上の可用性を保証（MVP基準）  
**根拠**: ハッカソンデモ期間での現実的な稼働目標  
**受入条件**: 
- デモ期間中の基本機能稼働
- 簡単な稼働確認
- 必要時のみバックアップ

---

## 4. 技術要件概要

本システムは以下の技術方針に基づいて構築される：

### 4.1 システム統合方針

#### 処理アーキテクチャ
- **7フェーズ統合処理**: コンセプト分析からセリフ配置まで一貫したワークフロー
- **Human-in-the-loop統合**: 各フェーズでユーザーフィードバックを受け付け、リアルタイム修正
- **品質ゲートシステム**: 各段階で品質基準を満たした結果のみ次フェーズへ進行

#### プレビューシステム方針
- **フェーズ特化プレビュー**: 各段階に特化したインタラクティブ編集機能
- **アダプティブ品質**: ユーザーデバイス性能に応じた品質レベル自動調整
- **バージョン管理**: 修正履歴の管理と比較機能による制作支援

### 4.2 パフォーマンス要件

#### 処理時間要件
- **全体処理時間**: 合理的な時間内での完了（フィードバック時間除く）
- **リアルタイム応答**: ユーザーインタラクションに対する即座の反応
- **同時処理**: 複数ユーザーの同時利用をサポート

#### 品質要件
- **AI生成品質**: 一定基準以上の品質を保証する自動品質管理
- **システム品質**: 高い可用性とパフォーマンスの維持
- **ユーザー体験**: 直感的で快適な操作性の実現

---

## 5. システムアーキテクチャ

### 5.1 システム構成図

```mermaid
graph TB
    subgraph "フロントエンド"
        A[Web UI] 
        B[モバイルアプリ]
    end
    
    subgraph "API層"
        C[API Gateway]
        D[認証サービス]
    end
    
    subgraph "処理層"
        E[7フェーズHITL処理エンジン]
        F[フィードバック管理システム]
        G[統合ファイル処理サービス]
    end
    
    subgraph "データ層"
        H[ユーザーDB]
        I[作品DB]
        J[ファイルストレージ]
    end
    
    subgraph "外部API"
        K[Google Imagen 4]
        L[Gemini Pro]
    end
    
    A --> C
    B --> C
    C --> D
    C --> E
    E --> F
    E --> G
    E --> K
    E --> L
    F --> H
    G --> I
    G --> J
```

### 5.2 データフロー図

```mermaid
sequenceDiagram
    participant U as ユーザー
    participant UI as Web UI
    participant API as API Gateway
    participant AI as AI処理エンジン
    participant DB as データベース
    
    U->>UI: テキスト入力（Claude風ホーム画面）
    UI->>API: HITL漫画生成リクエスト
    API->>AI: HITLセッション開始
    loop 7フェーズHITL処理
        AI->>UI: フェーズ開始通知
        AI->>AI: フェーズ実行（3-6秒）
        AI->>UI: フェーズ完了・プレビュー表示
        UI->>U: Artifact風プレビュー表示
        alt フィードバックあり
            U->>UI: 自然言語フィードバック
            UI->>AI: フィードバック適用
        else タイムアウト/スキップ
            UI->>AI: 次フェーズ進行
        end
    end
    AI->>DB: 最終結果保存
    AI->>UI: 完成モーダル表示
    UI->>U: PDF出力・新規作成オプション
```

### 5.3 技術方針

#### 基本技術方針
- **フロントエンド**: モダンなWeb技術による直感的なユーザーインターフェース
- **バックエンドAPI**: AI処理に適したサーバーサイド技術
- **データベース**: 拡張性とパフォーマンスを両立するデータストレージ
- **AI統合**: 高品質な生成AI APIの活用
- **インフラ**: 統合されたクラウド環境による運用効率化
- **セキュリティ**: 包括的なセキュリティ対策の実装

---

## 6. 制約事項とリスク

### 6.1 技術的制約

| 項目 | 制約内容 | 影響 |
|------|----------|------|
| API制限 | Google AI API 1日1,000リクエスト（MVP基準） | 同時ユーザー数制限 |
| 処理能力 | 単一処理に最大8GB RAM（MVP基準） | 基本スケーリング |
| ファイルサイズ | 出力PDF最大100MB | 長編作品制限 |

### 6.2 ビジネス制約

| 項目 | 制約内容 | 対策 |
|------|----------|------|
| 著作権 | 既存作品の類似性チェック必要 | AI検出システム導入 |
| 利用料金 | Google API従量課金 | 適切な課金モデル設計 |
| 法的責任 | 生成コンテンツの責任範囲 | 利用規約での明確化 |

### 6.3 リスク評価マトリクス

| リスク | 影響度 | 発生確率 | 対策 |
|--------|--------|----------|------|
| AI API障害 | 高 | 中 | 冗長化・代替API準備 |
| 著作権侵害 | 高 | 低 | 事前フィルタリング強化 |
| 処理性能劣化 | 中 | 中 | 監視・自動スケーリング |

---

## 7. 用語集と略語一覧

### 用語集

| 用語 | 定義 |
|------|------|
| HITLフェーズ | Human-in-the-loopによる7フェーズ処理フェーズ |
| Claude風UI | Claudeのダークテーマを参考にしたシンプルチャット画面 |
| Artifact風プレビュー | Claude Artifactの左右分割レイアウトを参考にした表示 |
| フィードバックタイムアウト | 各フェーズでの30秒間のユーザー応答待ち時間 |
| 品質ゲート | 各処理段階での品質基準チェックポイント |
| コマ割り | 漫画ページの構成・レイアウト設計 |
| フィジビリティ | 技術的・事業的実現可能性 |
| HITL | Human-in-the-loop（人間参加型AI）|
| 自然言語フィードバック | ユーザーが普通の言葉で修正指示を行うこと |

### 略語一覧

| 略語 | 正式名称 |
|------|----------|
| AI | Artificial Intelligence |
| API | Application Programming Interface |
| UI | User Interface |
| UX | User Experience |
| SLA | Service Level Agreement |
| PDF | Portable Document Format |
| TLS | Transport Layer Security |
| UTF-8 | 8-bit Unicode Transformation Format |

---

## 改訂履歴

| 版数 | 日付 | 変更内容 | 担当者 |
|------|------|----------|--------|
| 1.0 | 2025-01-15 | 初版作成 | [担当者名] |
| 2.0 | 2025-01-20 | 構造改善・要件ID付与 | Claude Code |
| 3.0 | 2025-08-24 | HITL機能統合・7フェーズ処理への変更 | Claude Code |
| 4.0 | 2025-08-24 | 実装済みClaud風UI・7フェーズHITL反映 | Claude Code |
| 5.0 | 2025-08-28 | Implementation_Requirements_Analysis.md統合・実装要件詳細追加 | Claude Code |

---

**文書承認**
- 技術責任者: [署名] 日付: [日付]
- プロダクトマネージャー: [署名] 日付: [日付]
- プロジェクトマネージャー: [署名] 日付: [日付]